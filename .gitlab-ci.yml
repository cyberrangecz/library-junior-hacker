image: registry.gitlab.ics.muni.cz:443/muni-kypo-images/docker-image-builder/packer:latest

stages:
  - test

workflow:
  rules:
    - if: $CI_COMMIT_TAG
      when: never
    - if: $CI_MERGE_REQUEST_ID
      when: never
    - when: always

default:
  tags:
    - image-builder

test-vagrant:
  stage: test
  script:
# Add 'vb.gui = false' after every 'device.vm.provider "virtualbox" do |vb|'
    - sed -i -E 's/((\s+)device\.vm\.provider\s+"virtualbox"\s+do\s+\|([^\|]+)\|)/\1\n\2  \3.gui = false/' Vagrantfile
    - vagrant up
